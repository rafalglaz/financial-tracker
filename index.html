<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dynamic Financial Tracker</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
        }

        h1, h2 {
            color: #333;
        }

        table {
            border-collapse: collapse;
            width: 100%;
            max-width: 100%;
        }

        th, td {
            border: 1px solid #ddd;
            padding: 8px;
            text-align: center;
        }

        th {
            background-color: #f2f2f2;
        }

        tr:hover {
            background-color: #f9f9f9;
        }

        thead th {
            position: sticky;
            top: 0;
            z-index: 1;
        }

        #tableContainer {
            max-height: 500px;
            overflow-y: auto;
            border: 1px solid #ddd;
            margin-bottom: 20px;
        }

        input, button, select {
            margin: 5px;
            padding: 10px;
        }

        button {
            background-color: #4CAF50;
            color: white;
            border: none;
            cursor: pointer;
        }

        button:hover {
            background-color: #45a049;
        }

        .log-entry {
            background-color: #f9f9f9;
            border: 1px solid #ddd;
            margin-top: 10px;
            padding: 10px;
        }

        .log-entry button {
            background-color: #ff4d4d;
        }

        .log-entry button:hover {
            background-color: #ff1a1a;
        }
    </style>
</head>
<body>
    <div id="content" style="display: none;">
        <h1>Financial Tracker</h1>
        <div id="transactionForm">
            <h2>Add Extra Income or Expense</h2>
            <label for="month">Month:</label>
            <select id="month">
                <!-- Dynamic months will go here -->
            </select>
            <label for="amount">Amount:</label>
            <input type="number" id="amount" required />
            <label for="type">Type:</label>
            <select id="type">
                <option value="income">Income</option>
                <option value="expense">Expense</option>
            </select>
            <button onclick="addTransaction()">Add Transaction</button>
        </div>

        <h2>Financial Overview</h2>
        <div id="tableContainer">
            <table id="financialTable">
                <thead>
                    <tr>
                        <th>Month</th>
                        <th>Income Type</th>
                        <th>Income</th>
                        <th>Shortfall/Surplus</th>
                        <th>Savings Change</th>
                        <th>Remaining Savings</th>
                        <th>House Payment</th>
                        <th>Remaining After Payment</th>
                        <th>Extra Income/Expense</th>
                        <th>Final Remaining Savings</th>
                    </tr>
                </thead>
                <tbody>
                    <!-- Table rows will go here -->
                </tbody>
            </table>
        </div>

        <h2>Transaction Log</h2>
        <div id="logEntries">
            <!-- Log entries will go here -->
        </div>
    </div>

    <script>
        // Password protection logic
        const password = "lillybella"; // Set your desired password here
        if (!localStorage.getItem("passwordValidated")) {
            const enteredPassword = prompt("Please enter the password to access this page:");
            if (enteredPassword.trim() !== password) {
                alert("Incorrect password! Redirecting to Google.");
                window.location.href = "https://www.google.com"; // Redirect to Google if the password is incorrect
            } else {
                // Store in localStorage so that user doesn't have to enter password again
                localStorage.setItem("passwordValidated", "true");
                window.location.reload(); // Reload the page to proceed after password validation
            }
        }

        window.onload = function () {
            // Display content after password validation
            document.getElementById("content").style.display = "block";

            const data = [
                // Your initial financial data here...
            ];

            let transactionLog = JSON.parse(localStorage.getItem("transactionLog")) || [];

            // Recalculate Final Remaining Savings
            function recalculateFinalSavings() {
                for (let i = 0; i < data.length; i++) {
                    if (i === 0) {
                        data[i].finalRemaining = data[i].remainingAfterPayment + data[i].extra;
                    } else {
                        data[i].finalRemaining = data[i - 1].finalRemaining + data[i].remainingAfterPayment + data[i].extra - data[i - 1].remainingAfterPayment;
                    }
                }
            }

            // Render Table
            function renderTable() {
                const tbody = document.querySelector("#financialTable tbody");
                tbody.innerHTML = "";
                data.forEach(row => {
                    const tr = document.createElement("tr");
                    tr.innerHTML = `
                        <td>${row.month}</td>
                        <td>${row.incomeType}</td>
                        <td>£${row.income}</td>
                        <td>£${row.shortfallSurplus}</td>
                        <td>£${row.savingsChange}</td>
                        <td>£${row.remainingSavings}</td>
                        <td>£${row.housePayment}</td>
                        <td>£${row.remainingAfterPayment}</td>
                        <td>£${row.extra}</td>
                        <td>£${row.finalRemaining}</td>
                    `;
                    tbody.appendChild(tr);
                });
            }

            // Add Extra Income or Expense
            function addTransaction() {
                const month = document.getElementById("month").value;
                const amount = parseFloat(document.getElementById("amount").value);
                const type = document.getElementById("type").value;

                const row = data.find(r => r.month === month);
                if (row) {
                    row.extra += (type === "income" ? amount : -amount);
                    recalculateFinalSavings();
                    renderTable();

                    // Log the transaction
                    const logEntry = {
                        date: new Date().toLocaleDateString(),
                        month: month,
                        amount: amount,
                        type: type
                    };
                    transactionLog.push(logEntry);
                    localStorage.setItem("transactionLog", JSON.stringify(transactionLog)); // Store in localStorage
                    renderLog();
                } else {
                    alert("Month not found in the table!");
                }
            }

            // Render the Transaction Log
            function renderLog() {
                const logContainer = document.getElementById("logEntries");
                logContainer.innerHTML = "";
                transactionLog.forEach((entry, index) => {
                    const logEntryDiv = document.createElement("div");
                    logEntryDiv.className = "log-entry";
                    logEntryDiv.innerHTML = `
                        <strong>${entry.date}:</strong> ${entry.amount} - ${entry.type === "income" ? "Extra Income" : "Extra Expense"} for ${entry.month}
                        <button onclick="removeLogEntry(${index})">Remove</button>
                    `;
                    logContainer.appendChild(logEntryDiv);
                });
            }

            // Remove Log Entry
            function removeLogEntry(index) {
                const removedLog = transactionLog.splice(index, 1);
                localStorage.setItem("transactionLog", JSON.stringify(transactionLog)); // Update in localStorage
                renderLog();

                // Undo last transaction for calculations only (do not refresh table data completely)
                const entry = removedLog[0];
                const row = data.find(r => r.month === entry.month);
                if (row) {
                    row.extra -= (entry.type === "income" ? entry.amount : -entry.amount);
                    recalculateFinalSavings();
                    renderTable();
                }
            }

            // Initial Calculation and Render
            recalculateFinalSavings();
            renderTable();
            renderLog();

            // Dynamically populate the month dropdown
            const monthSelect = document.getElementById("month");
            data.forEach(row => {
                const option = document.createElement("option");
                option.value = row.month;
                option.textContent = row.month;
                monthSelect.appendChild(option);
            });
        };
    </script>
</body>
</html>
